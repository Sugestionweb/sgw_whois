<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<!-- Modify Portal "my/home/ to add Services -->
	<template id="portal_my_home_services"
		name="Portal My Home : Services" inherit_id="portal.portal_my_home"
		priority="20">
		<xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
			<t t-if="service_count" t-call="portal.portal_docs_entry">
				<t t-set="title">Servicios</t>
				<t t-set="url" t-value="'/my/services'" />
				<t t-set="count" t-value="service_count" />
			</t>
		</xpath>
	</template>

	<!-- Modify breadcrumbs "my/home/ to add Services -->
	<template id="portal_my_home_menu_service"
		name="Portal layout : service menu entries"
		inherit_id="portal.portal_breadcrumbs" priority="30">
		<xpath expr="//ol[hasclass('o_portal_submenu')]"
			position="inside">
			<li t-if="page_name == 'service'"
				t-attf-class="breadcrumb-item #{'active ' if not service else 'else'}">
				<a t-if="service" t-attf-href="/my/services?{{ keep_query() }}">Servicios</a>
				<t t-else="">Servicios</t>
			</li>
			<li t-if="service" class="breadcrumb-item active">
				<t t-esc="service.number" t-if="service.number" />
				<t t-else="">
					<em>Servicio en Borrador</em>
				</t>
			</li>
		</xpath>
	</template>

	<template id="portal_my_listservices" name="My Services">
		<t t-call="portal.portal_layout">
			<t t-set="breadcrumbs_searchbar" t-value="True" />

			<t t-call="portal.portal_searchbar">
				<t t-set="title">Servicios</t>
			</t>
			<t t-if="not services">
				<p>No hay servicios asociados a su cuenta.</p>
			</t>
			<t t-if="services" t-call="portal.portal_table">
				<thead>
					<tr class="active">
						<th>Servicio #</th>
						<th>Cliente</th>
						<th>Nombre</th>
						<th>Periodo</th>
						<th>Próx. Renovación</th>
					</tr>
				</thead>
				<t t-foreach="services" t-as="service">
					<tr>
						<td>
							<a t-att-href="service.get_portal_url()">
								<t t-esc="service.number" />
							</a>
						</td>
						<td>
								<t t-esc="service.name" />
						</td>
						<td>
							<t t-esc="service.partner_id.name" />
						</td>

						<td>
							<t t-esc="service.prolong_interval" />
							-
							<t t-esc="service.prolong_unit" />
						</td>

						<td>
							<span class='d-none d-md-inline'
								t-field="service.next_expiration_date"
								t-options="{'time_only': True}" />
						</td>

					</tr>
				</t>
			</t>
		</t>
	</template>

	<template id="portal_service_template" name="Portal Service">
		<t t-call="portal.portal_layout">
			<t t-set="breadcrumbs_searchbar" t-value="True" />
			<t t-call="portal.portal_searchbar">
				<t t-set="title">Servicios</t>
			</t>

			<t t-if="service" t-call="portal.portal_table">
				<h3>
					<span t-field="service.name" />
				</h3>
				<h4>
					<span t-field="service.partner_id" />
				</h4>
				<thead>
					<tr class="active">
						<th>Servicio</th>
						<th>Descripción</th>
						<th>Cantidad</th>
						<th>Último pedido</th>
						<th>Servidor</th>
						<th>Panel de control</th>
						<th>Usuario</th>
					</tr>
				</thead>
				<t t-foreach="service.service_line" t-as="serviceline">
					<tr>
						<td>
							<a t-attf-href="/shop/product/#{slug(serviceline.product_id.product_tmpl_id) }"  >
								<span t-field="serviceline.product_id" />
							</a>
							
						</td>
						<td>
							<span t-field="serviceline.additional_description" />
						</td>
						<td>
							<span t-field="serviceline.quantity" />
						</td>
						<td>
							<span t-field="serviceline.last_order_date" />
						</td>

						<td>
							<t t-esc="serviceline.server_id.name" />
						</td>
						<td>
							<t t-if="serviceline.server_control_panel_overwrite">
								<a target="_blank" t-att-href="serviceline.server_control_panel_url_specific">
									<t t-esc="serviceline.server_id.control_panel.name" />
								</a>
							</t>
							<t t-if="not serviceline.server_control_panel_overwrite">
								<a target="_blank" t-att-href="serviceline.server_id.control_panel_url">
									<t t-esc="serviceline.server_id.control_panel.name" />
								</a>
							</t>

						</td>
						<td>
							<t t-esc="serviceline.server_control_panel_user" />
						</td>

					</tr>
				</t>
			</t>
			<br/><br/><br/><br/>
			<div class="well"><h4>Si no recuerda la contraseña de alguno de sus servicios <a href="/support/ticket/submit">contacte con nuestro soporte técnico</a> </h4></div>
		</t>


	</template>


	<template id="portal_panel_webmail_template"
		name="Panel webmail template">
		<t t-call="portal.portal_layout">
			<section class="exampleBox">
				<div class="block">
					<div class="heading">
						<h2>Acceso Panel de control</h2>
					</div>
					<div class="text">
						<ul>
							<t t-foreach="servers" t-as="server">
								<li>
									<a t-att-href="server.control_panel_url">
										<img
											t-att-src="'/web/binary/image?model=sgw.controlpanel&amp;field=image_small&amp;id=%s' % server.control_panel.id"
											alt="" />
									</a>
									<h3>
										<a t-att-href="server.control_panel_url">
											<t t-esc="server.name" />
										</a>
										<span>
											<b>
												<t t-esc="server.control_panel.name" />
											</b>
										</span>
										<span>
											<t t-esc="server.operating_system_id.name" />
										</span>
									</h3>
								</li>
							</t>
						</ul>
					</div>
					<div class="clear"></div>
				</div>
			</section>
		</t>
	</template>

</odoo>